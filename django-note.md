# django application 만들기 튜토리얼

모든 작업은 파이썬 가상환경 (virtualenv)안에서 이뤄져야 한다.  
현재 console에서 (appvenv) 같은 가상환경 활성화 접두어가 안보인다면 `$source myvenv/bin/activate` 를 입력해서 먼저 활성화시킨다. 

## django 새 프로젝트 빌드 
`$ django-admin startproject <app-admin name> .`  

- django-admin.py 스크립트는 프로젝트 빌드를 위한 디렉토리와 파일들을 생성한다.  스크립트를 실행하면 프로젝트가 아래와 같은 구조로 초기화된다.  
```
djangoApp  
├── manage.py : 사이트 관리를 도와주는 역할, 이 스크립트가 있으면 다른 설치 작업 없이 PC에서 웹 서버를 시작할 수 있다.   
└── webapp  
    ├── __init__.py  
    ├── settings.py : 웹사이트 설정을 하는 파일이다. 웹사이트가 보여지는 모습을 설정한다. 예를들면, 언어, 시간대 등  
    ├── urls.py : urlresolver가 사용하는 url 주소 패턴 목록이다.  
    ├── wsgi.py  
    └── asgi.py  
```
## 인터넷의 작동 원리  
웹 사이트는 실제로, 동영상, 음악, 사진 같은 파일이 하드디스크에 저장된 파일묶음이다.  
다른 일반파일과 다른점은 파일 안에 html 파일이 있다는 점이다.  
이 html 파일은 웹 브라우저라는 소프트웨어를 통해서 코드가 읽히고 지시사항이 동작하도록 설계된다.  
보통 웹 사이트 프로그램은 인터넷을 통해 여러 사용자에게 보여져야 하기 때문에 하드디스크에 웹 사이트 복제본을 여러개 두어야 하는데, 개인용 PC 에서는 이러한 기능을 하기에 사양이 부족한 이유로 서버라는 특별하고 강력한 PC를 사용해서 저장해둔다.  
서버는 데이터를 저장하거나 제공하는 것이 주된 목적이기 때문에 모니터나 마우스, 키보드 같은 개인 PC에 특화된 장치는 필요하지 않다.  
즉, PC 중에서도 데이터를 저장하고 제공(server)하는 일만을 맡는 PC를 서버(server)라고 부른다.  
인터넷 네트워크는 여러대의 서버와 PC를 연결한 구조를 지칭하는 것인데, 우리가 인터넷에 접속하고 특정 사이트를 방문하는 모든 접속은 인터넷주소(url)라는 구분 기술을 활용해서 수많은 PC나 네트워크 장치들을 통과한 후에 도달하게 되는 것이다.  
그림으로 이해하길 원한다면 이 [링크](https://tutorial.djangogirls.org/ko/how_the_internet_works/#%EC%9D%B8%ED%84%B0%EB%84%B7%EC%9D%80-%EC%96%B4%EB%96%BB%EA%B2%8C-%EC%9E%91%EB%8F%99%ED%95%A0%EA%B9%8C%EC%9A%94)를 접속하면 도움이 된다.  
조금 더 구체적으로 들어가면 우리는 원하는 주소로 웹 사이트를 열고 싶다고 네트워크로 접속하면서 요청(request)하게 된다.  
보통 request는 데이터 패킷이라고 불려지는 단위로 뭉쳐져서 네트워크에서 원하는 주소에 도달할때까지 라우터를 거치면서 전달된다.  
라우터는 원하는 주소로 도달할 수 있게 패킷을 전달방식에 알맞은 형태로 변형해가며 서버에서 서버로 이동하게 도와주는 역할이다.  
그리고 원하는 주소에 도달한 패킷은 서버가 읽어들이고 서버로부터 접속 허용/불가와 웹 사이트 정보를 포함한 응답(response) 패킷이 다시 사용자의 서버로 네트워크를 거쳐 전단된다.  
접속이 허용되면 사용자 PC에서 웹 사이트 정보가 화면에 띄워지는 것이고, 접속이 허용되지 않으면 404 같은 오류 화면이 사용자에게 띄워진다.  
서버에서 서버로 즉 네트워크를 거치는 과정에서는 IP주소 또는 DNS(도메인주소), 패킷전송방식, port, 프로토콜 등의 컴퓨터 기술이 활용된다.  

## Django 는 도대체 무엇?  
파이썬으로 만들어진 무료 오픈소스 웹 애플리케이션 프레임워크다.  
프레임워크는 개발자가 반복되는 작업을 빠른 시간안에 재활용할 수 있도록 특정 프로젝트를 만드는데에 필요한 개발도구들을 키트로 만들어둔 것을 지칭한다.  
웹 프레임워크는 다시말해서, 쉽고 빠르게 웹 사이트 프로젝트를 개발할 수 있도록 필요 구성요소들로 이루어진 개발키트가 되는 것이다.  
Django 프레임워크에는 개발도구로 회원가입, 로그인, 로그아웃, 사용자 인증, 관리자패널, 폼, 파일업로드 등 같이 웹 사이트에 많이 사용되는 도구들로 구성되어 있다.  
이러한 특정 프로젝트에 특화되어 만들어진 프레임워크를 사용하게 되면 처음부터 개발해야 하는 막막함으로부터 해방감을 주게 되고, 처음 개발할때 발생하는 시간적비용의 부담을 덜어준다.  
또한, 내가 만든 웹 사이트를 남들이 사용할 수 있게 하려면 웹 서버에 배포하고, 웹 서버에서 요청이 오면 웹 사이트 정보를 전달하는 등의 작업도 해야하는데 그러한 부가적인 작업을 Django 프레임워크에서 담당하기 때문에 개발자는 오롯이 더 좋은 웹 사이트를 개발하는데에 시간을 할애할 수 있게 된다.  

내가 웹 사이트를 배포해둔 웹 서버에 요청이 들어오면 곧바로 Django 로 전달된다.  
전달된 형태는 `urlresolver` 라는 것으로, Django를 이 데이터를 열어서 무엇을 해야하는지 확인하고 필요한 동작을 수행한다.  
사실상, 이 동작은 굉장히 단순하다. 그저 urlresolver에 적힌 url 정보를 Django가 개발자 웹서버의 패턴목록에서 하나씩 대조해가며 식별한 후 일치하는 url이 있으면 그것을 view 에 전달하고 response를 만드는 작업을 진행한다.  
데이터베이스에 필요한 데이터를 꺼내오거나 저장하거나 수정하거나 response를 만드는 등의 핵심적인 작업은 거의 view라는 공간에서 이루어진다.  
view도 마찬가지로 그냥 파일이다. 파일 안에서 이루어져야되는 작업들이 함수를 사용해서 이루어지는 것일 뿐이다.  

## Django Model 구조 파헤치기  
### Object 먼저 이해하기
객체 개념을 사용해서 개발하는 방법은 모델을 만들어서 그 모델이 어떤 역할을 가지고 어떻게 행동해야 하는지 정의해서 서로 상호작용할 수 있게 만드는 방법이다.  
즉, 프로그램이 어떻게 작동해야 하는지 모든것을 하나하나 지시하는 방식으로 개발하는 것이 아니다.  

객체를 사용해서 개발하는 방법을 객체 지향 프로그래밍 (OOP) 이라고 부른다.  
객체는 속성과 행동을 모아놓은 집합체를 일컫는다.  
프로그래밍 용어로는, 속성은 `property` 라고 하고, 행동은 `method` 라고 한다.  
객체를 생성할때는 객체의 속성과 행동부터 파악해서 정의내리는 일부터 시작하면 된다.  

### Django에서의 모델 이해하기
Django에서 말하는 모델은 객체의 한 종류를 가리킨다.  
모델안의 내용들은 데이터베이스에 저장된다는 점이 일반 객체와는 다른 점이라고 할 수 있다.  
Django의 데이터베이스 기본 어댑터 값은 SQLite3 이다.  
데이터베이스 안에 테이블과 필드(컬럼), 데이터(행)로 구성되는 것과 같이 모델도 비슷하게 구성되어 있다.  

### Django 프로젝트에서 새 애플리케이션 생성
1. Django 애플리케이션의 루트 디렉토리에서 `$ python manage.py startapp <app_name>` 을 실행한다.  
애플리케이션을 생성했으면 Django에 이 app을 사용할거라고 알려줘야 한다.  
이에 대한 설정은 settings.py에서 한다.  
INSTALLED_APPS 속성에 만든 앱 이름(firstblog)을 추가한다.  
```
    djangoApp
    ├── webapp
    |       __init__.py
    |       settings.py
    |       urls.py
    |       wsgi.py
    |       asgi.py
    ├── manage.py
    └── firstblog
        ├── migrations
        |       __init__.py
        ├── __init__.py
        ├── admin.py
        ├── models.py : 모든 객체(모델) 선언 
        ├── tests.py
        └── views.py
```

#### models 스크립트 작성에 대한 설명 
1. from 과 import 로 시작하는 부분은 현재 스크립트 파일에다가 다른 파일에서 만든 property 또는 method를 추가한다는 뜻이다.  
다시말하면, 필요한 속성 또는 메서드를 매번 번거롭게 복사, 붙여넣기 해야하는 필요를 없애고 from 과 import 를 사용해서 그것들을 불러오는 작업을 하는 것이다.  

2. class 는 파이썬에서 클래스를 만드는 키워드다. 클래스를 만든다는 것은 곧 객체를 정의한다는 의미이다. class 키워드 옆에 객체의 이름을 작성하면 된다. 이름은 반드시 대문자로 시작해야 한다.  
다른 객체를 상속할때는 클래스 이름 옆 괄호안에 상속할 객체의 이름을 적는다. 객체는 상속한 객체의 속성과 메서드를 전부 부여받는다.  
Django에서 객체를 모델로 인식하게 하려면 models.Model을 상속한 객체를 생성해야 한다. 그러면 모든 모델은 데이터베이스에 저장되게 된다.  

모델을 만들때 필요한 속성과 메서드를 알려면 [Django docs 공식 문서](https://docs.djangoproject.com/en/2.0/ref/models/fields/#field-types)를 확인해보면 된다.   

3. method를 정의할때는 def 키워드를 사용한다.  
메서드는 보통 반환값을 가진다. 즉, 어떤 값을 되돌려준다는 의미다. 반환값은 return 키워드를 사용해서 정의한다.  

### 애플리케이션에 추가한 모델을 데이터베이스에 추가하기
models.py 에 모델을 작성했다면 실질적으로 Django 데이터베이스에 모델이 저장되도록 해야한다.  
`$ python manage.py makemigrations <appname>` 을 실행한다.  
makemigrations 은 모델을 데이터베이스에 마이그레이션 하는 명령어이다. 
그 다음 `$ python manage.py migrate <appname>` 을 실행하면 실제 Django 데이터베이스에 모델이 추가된다.  

### Django 관리자 모드
애플리케이션에서 모델을 모델링하면 django 관리자로 모델들을 관리(수정,삭제,추가) 할 수 있다.  
이 부분은 `admin.py` 스크립트에서 작성한다.  
관리자 페이지에서 관리하고자 하는 모델은 `admin.site.register(modelname)` 을 작성해두면 된다.  
중요한것은, 관리자 모드에 접속하려면 슈퍼유저가 있어야 한다.  
슈퍼유저는 `$ python manage.py createsuperuser` 명령어로 만들 수 있다.  
django 관리자에 대한 더 자세한 설명은 [관리자 docs](https://docs.djangoproject.com/en/2.0/ref/contrib/admin/) 를 참고바란다.  
```
//내 슈퍼 유저
username: superuser
email: superuser@admin.com
password: qwer0987
```

## 애플리케이션 배포하는 방법 
애플리케이션을 내 PC에서 만들고 나면 배포하기 전까지는 내 PC에서만 웹 사이트를 접속하고 볼 수 있다.  
배포는 애플리케이션을 인터넷에 올려서 다른 사람도 볼 수 있게 해두는 것을 말한다.  
인터넷에 올리는 것은 인터넷 상의 서버에 저장해두는 걸 말한다.  

배포를 위해서는 호스팅 서비스를 제공하는 업체를 보통 활용한다.  
그래서 웹 사이트를 만들때에는 개인 로컬 PC와 아래 두가지 기능을 할 수 있는 업체를 선정해두어야 한다.  
- [pythonanywhere](https://www.pythonanywhere.com/) : 방문자가 그리 많지 않은 소규모 애플리케이션을 위한 무료 서비스를 제공하는 호스팅 서비스다.  
- [github code hosting service](https://github.com/) : 거의 모든 개발자들은 깃허브 계정을 가지고 있고, 이곳에 애플리케이션의 복사본을 저장해두면 된다. 

### git 간단 설명
git은 기본적으로 로컬 PC 즉, 개발자가 개발하는 PC에서 코드 버전을 관리할 수 있도록 기능을 제공한다.  
그러나 메모리 한계와 여러 프로그램 개발 등으로 개인 PC에서 뿐만 아니라 원격으로 여러 개발자들이 함께 공동 개발을 할 경우에는 코드를 계속 업데이트하고 공유해야 하는데 이를 github 같은 호스팅 업체에서 지원하고 있다.  
git 과 github 둘다 코드 저장소 즉 리포지토리라는 곳에 특정 애플리케이션을 구성하는 파일들을 한데 모아 변환를 추적하고 관리할 수 있게 한다.  
로컬 PC에서 새로운 리포지토리를 생성하려면 초기화 명령어를 실행한다.  
중요한것은, 프로젝트 디렉토리에서 리포지토리를 생성해야 한다.  
```
$ git init
$ git config --global user.name "git_user_name"
$ git config --global user.email "git_user_email"

$ git config list  //name, email 설정 잘 되었는지 확인 
```
